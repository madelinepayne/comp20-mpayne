<!DOCTYPE html>
<html>
<head>
    <title>Not Uber</title>
<!--     <script type="text/javascript" src=src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBxhem2x2mWEHYY0qs_NOqjYotDFCX8Mvc&callback=init"
    async defer></script> -->
    <script src="http://maps.googleapis.com/maps/api/js?sensor=false"></script> 
    <link rel="stylesheet" href="index.css" />
    <script type="text/javascript">
        var mylat = 0;
        var mylng = 0;
        var me = new google.maps.LatLng(mylat, mylng);
        var myOptions = {
            zoom: 13,
            center: me,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map;
        var marker;
        var infowindow = new google.maps.InfoWindow();
        var request = new XMLHttpRequest();
        var username = "ZoxN11Sa";
        
        function init()
        {
            map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
            getMyLocation();
        }
        
        function getMyLocation()
        {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    mylat = position.coords.latitude;
                    mylng = position.coords.longitude;
                    renderMap();
                });
            }
            else {
                alert("Geolocation is not supported on your web browser.");
            }
        }
        
        function renderMap()
        {
            me = new google.maps.LatLng(mylat,mylng);
            
            map.panTo(me);
            
            marker = new google.maps.Marker({
                position: me,
                title: "ZoxN11Sa"
            });
            marker.setMap(map);
            
            google.maps.event.addListener(marker, 'click', function () {
                infowindow.setContent(marker.title);
                infowindow.open(map, marker);
            });
        }
        // request.onreadystatechange = function() 
        // {
            request.open("POST", "https://defense-in-derpth.herokuapp.com/submit", true);
            request.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            var data_to_send = "username=" + username + "&lat=" + mylat + "&lng=" + mylng;
            request.send(data_to_send);
            
            request.onreadystatechange = function() {
                if (request.readyState == 4 && request.status == 200) {
                    var jsonObj = request.responseText;
                    var elements = JSON.parse(jsonObj);
                    
                    if (jsonObj[2] == "p") {
                        
                    }
                    // console.log(jsonObj);
                    var vehicle = "";
                    var username, _id, lat, lng, created_at;
                    for (i in elements) {
                        vehicle._id = elements[i]._id;
                        console.log(vehicle._id);
                        vehicle.username = elements[i].username;
                        vehicle.lat = elements[i].lat;
                        vehicle.lng = elements[i].lng;
                        vehicle.created_at = elements[i].created_at;
                       
                    // console.log(elements);
                    }
                    
                }
            }
    </script>

</head>
<body onload="init()">
    <div id="map_canvas"></div>
</body>
</html>